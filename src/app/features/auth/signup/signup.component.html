<app-auth-header [pageType]="'signup'"></app-auth-header>

<main class="signup-page">
  <div class="signup-container">
    <!-- Page Title Section -->
    <div class="signup-header">
      <h1 class="signup-header__title">{{ translationService.translate('auth.signup.title') }}</h1>
      <p class="signup-header__subtitle">{{ translationService.translate('auth.signup.subtitle') }}</p>
    </div>

    <!-- Form Card -->
    <div class="signup-card">
      <form [formGroup]="signupForm" (ngSubmit)="onSubmit()" class="signup-form">
        
        <!-- Full Name Field -->
        <div class="form-field">
          <label class="form-field__label" for="fullName">
            {{ translationService.translate('auth.signup.fields.fullName.label') }}
          </label>
          <input
            id="fullName"
            type="text"
            formControlName="fullName"
            class="form-field__input"
            [class.form-field__input--error]="isFieldInvalid('fullName')"
            [placeholder]="translationService.translate('auth.signup.fields.fullName.placeholder')"
          />
          <span *ngIf="isFieldInvalid('fullName')" class="form-field__error">
            {{ getFieldError('fullName') }}
          </span>
        </div>

        <!-- Username Field -->
        <div class="form-field">
          <label class="form-field__label" for="username">
            {{ translationService.translate('auth.signup.fields.username.label') }}
          </label>
          <input
            id="username"
            type="text"
            formControlName="username"
            class="form-field__input"
            [class.form-field__input--error]="isFieldInvalid('username')"
            [placeholder]="translationService.translate('auth.signup.fields.username.placeholder')"
          />
          <span *ngIf="isFieldInvalid('username')" class="form-field__error">
            {{ getFieldError('username') }}
          </span>
        </div>

        <!-- Phone Number Field -->
        <div class="form-field">
          <label class="form-field__label" for="phone">
            {{ translationService.translate('auth.signup.fields.phone.label') }}
          </label>
          <input
            id="phone"
            type="tel"
            formControlName="phone"
            class="form-field__input"
            [class.form-field__input--error]="isFieldInvalid('phone')"
            [placeholder]="translationService.translate('auth.signup.fields.phone.placeholder')"
          />
          <span *ngIf="isFieldInvalid('phone')" class="form-field__error">
            {{ getFieldError('phone') }}
          </span>
        </div>

        <!-- Password Field -->
        <div class="form-field">
          <label class="form-field__label" for="password">
            {{ translationService.translate('auth.signup.fields.password.label') }}
          </label>
          <div class="form-field__input-wrapper">
            <input
              id="password"
              [type]="showPassword ? 'text' : 'password'"
              formControlName="password"
              class="form-field__input"
              [class.form-field__input--error]="isFieldInvalid('password')"
              [placeholder]="translationService.translate('auth.signup.fields.password.placeholder')"
            />
            <button
              type="button"
              class="form-field__toggle"
              (click)="togglePasswordVisibility()"
              [attr.aria-label]="showPassword ? 'Hide password' : 'Show password'"
            >
              <svg *ngIf="!showPassword" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              <svg *ngIf="showPassword" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                <line x1="1" y1="1" x2="23" y2="23"></line>
              </svg>
            </button>
          </div>
          
          <!-- Password Strength Indicator -->
          <div *ngIf="signupForm.get('password')?.value" class="password-strength">
            <div class="password-strength__bars">
              <div
                *ngFor="let bar of getPasswordStrengthBars()"
                class="password-strength__bar"
                [style.background-color]="getBarColor(bar)"
              ></div>
            </div>
            <span class="password-strength__label" *ngIf="passwordStrength">
              {{ currentLang === 'fr' ? passwordStrength.label.fr : passwordStrength.label.en }}
            </span>
          </div>
          
          <span class="form-field__helper">
            {{ translationService.translate('auth.signup.fields.password.helper') }}
          </span>
          <span *ngIf="isFieldInvalid('password')" class="form-field__error">
            {{ getFieldError('password') }}
          </span>
        </div>

        <!-- Confirm Password Field -->
        <div class="form-field">
          <label class="form-field__label" for="confirmPassword">
            {{ translationService.translate('auth.signup.fields.confirmPassword.label') }}
          </label>
          <div class="form-field__input-wrapper">
            <input
              id="confirmPassword"
              [type]="showConfirmPassword ? 'text' : 'password'"
              formControlName="confirmPassword"
              class="form-field__input"
              [class.form-field__input--error]="isFieldInvalid('confirmPassword') || signupForm.errors?.['passwordMismatch']"
              [placeholder]="translationService.translate('auth.signup.fields.confirmPassword.placeholder')"
            />
            <button
              type="button"
              class="form-field__toggle"
              (click)="toggleConfirmPasswordVisibility()"
              [attr.aria-label]="showConfirmPassword ? 'Hide password' : 'Show password'"
            >
              <svg *ngIf="!showConfirmPassword" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              <svg *ngIf="showConfirmPassword" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                <line x1="1" y1="1" x2="23" y2="23"></line>
              </svg>
            </button>
          </div>
          <span *ngIf="isFieldInvalid('confirmPassword') || (signupForm.errors?.['passwordMismatch'] && signupForm.get('confirmPassword')?.touched)" class="form-field__error">
            {{ getFieldError('confirmPassword') }}
          </span>
        </div>

        <!-- Terms & Conditions Checkbox -->
        <div class="form-field form-field--checkbox">
          <label class="checkbox-label">
            <input
              type="checkbox"
              formControlName="acceptTerms"
              class="checkbox-label__input"
            />
            <span class="checkbox-label__text">
              <span [innerHTML]="getTermsLabelHtml()"></span>
            </span>
          </label>
          <span *ngIf="isFieldInvalid('acceptTerms')" class="form-field__error">
            {{ translationService.translate('auth.signup.fields.terms.errors.required') }}
          </span>
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="btn btn--primary"
          [disabled]="signupForm.invalid"
        >
          {{ translationService.translate('auth.signup.submit') }}
        </button>
      </form>
    </div>

    <!-- Divider -->
    <div class="divider">
      <div class="divider__line"></div>
      <span class="divider__text">{{ translationService.translate('auth.signup.hasAccount') }}</span>
      <div class="divider__line"></div>
    </div>

    <!-- Sign In Link -->
    <div class="signin-link">
      <a routerLink="/connexion" class="signin-link__text">
        {{ translationService.translate('auth.signup.signIn') }}
      </a>
    </div>

    <!-- Security Badge Section -->
    <div class="security-badge">
      <svg class="security-badge__icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
        <path d="m9 12 2 2 4-4"></path>
      </svg>
      <div class="security-badge__content">
        <h3 class="security-badge__title">{{ translationService.translate('auth.signup.security.title') }}</h3>
        <p class="security-badge__description">{{ translationService.translate('auth.signup.security.description') }}</p>
      </div>
    </div>
  </div>
</main>
